#!/usr/bin/env python3
"""
ccb-layout - Start a 2x2 four-AI layout (Claude + Codex + Gemini + OpenCode).

Implementation: delegate to `ccb up codex gemini opencode`.
- WezTerm/iTerm2: ccb uses a 2x2 grid when all three backends are present.
- tmux: if `ccb up` is executed inside tmux, ccb uses splits in the current window.
"""

from __future__ import annotations

import shutil
import subprocess
import sys
from pathlib import Path

script_dir = Path(__file__).resolve().parent
repo_root = script_dir.parent


def _resolve_ccb() -> str:
    on_path = shutil.which("ccb")
    if on_path:
        return on_path
    candidate = repo_root / "ccb"
    if candidate.exists():
        return str(candidate)
    return "ccb"


def main(argv: list[str]) -> int:
    if len(argv) > 1 and argv[1] in ("-h", "--help"):
        print("Usage: ccb-layout [-r] [-a]", file=sys.stderr)
        return 0

    ccb_cmd = _resolve_ccb()
    cmd = [ccb_cmd, "up", "codex", "gemini", "opencode", *argv[1:]]
    try:
        return subprocess.run(cmd).returncode
    except KeyboardInterrupt:
        return 130


if __name__ == "__main__":
    raise SystemExit(main(sys.argv))
