# CCB 4.0 版本更新说明

> 基于 CCB 4.0 版本更新分析内容整理

## 🏗️ 核心架构变化

| 变化点       | 说明                                                   |
| :----------- | :----------------------------------------------------- |
| **定位转变** | 从多终端支持转向 **tmux-first** 架构，强调终端无关理念 |
| **全量重构** | 代码结构进行了全面重构，显著提升稳定性                 |

## ✨ 主要新增功能

### 1. 终端后端抽象层

> 📍 文件位置: `lib/terminal.py`

- 🆕 新增 `TerminalBackend` 抽象类
- ✅ 实现多种后端支持：
  - `TmuxBackend`
  - `WeztermBackend`
  - `Iterm2Backend`
- ⚙️ 支持终端自动检测与 WSL 路径处理

### 2. tmux UI 强化

提供了一组脚本以增强 tmux 环境下的用户体验：

| 脚本/文件         | 功能描述                               |
| :---------------- | :------------------------------------- |
| `ccb-tmux-on.sh`  | 保存原会话配置并应用 CCB 主题          |
| `ccb-tmux-off.sh` | 退出时恢复原主题（实现**可恢复体验**） |
| `ccb-border.sh`   | 动态设置活动边框颜色                   |
| `ccb-status.sh`   | 显示守护进程/会话状态                  |
| `tmux-ccb.conf`   | tmux 配置（复制/鼠标/窗格管理等）       |

### 3. 会话稳定性增强

- 📄 **Session 管理**（`lib/session_utils.py`）：更稳健的 session 文件写入机制
- 🔄 **Pane 注册**（`lib/pane_registry.py`）：增加 pane/session 持久映射与 TTL 清理

### 4. 新增布局工具

- 🖥️ **CCB Layout**（`bin/ccb-layout`）：一键生成 2x2 多模型布局入口

## 🔄 v3.0 vs v4.0 对照

| 版本     | 重点特性                                                     |
| :------- | :----------------------------------------------------------- |
| **v3.0** | Smart Daemons (`caskd`/`gaskd`/`oaskd`)、并行队列、跨 Agent 协作 |
| **v4.0** | 结构重构 + tmux 体验一致性 + 可恢复主题                       |

## ⚠️ 注意事项

- **版本号一致性**：请确保 `README` 版本标注与 `ccb` 入口脚本中的 `VERSION` 一致；如不一致，建议执行 `ccb update` 同步安装目录文件。

